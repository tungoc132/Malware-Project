try {
    $poshgitPath = join-path (Get-ToolsLocation) ('pos'+'hg'+'it')

    try {
      if (test-path($poshgitPath)) {
        Write-Host ('Attempti'+'n'+'g '+'t'+'o '+'remove'+' '+'e'+'xisti'+'ng '+"`'$poshgitPath`'.")
        remove-item $poshgitPath -recurse -force
      }
    } catch {
      Write-Host ('C'+'oul'+'d '+'not'+' '+'remov'+'e'+' '+"`'$poshgitPath`'")
    }

    $version = "v$Env:chocolateyPackageVersion"
    if ($version -eq 'v') { $version = ('maste'+'r') }
    $poshGitInstall = if ($env:poshGit ) { $env:poshGit } else { "https://github.com/dahlbyk/posh-git/zipball/$version" }
    $zip = Install-ChocolateyZipPackage ('po'+'sh'+'git') $poshGitInstall $poshgitPath
    $currentVersionPath = Get-ChildItem "$poshgitPath\*posh-git*\" | Sort-Object -Property LastWriteTime | Select-Object -Last 1

    if(Test-Path $PROFILE) {
        $oldProfile = @(Get-Content $PROFILE)

        . $currentVersionPath\src\Utils.ps1
        $oldProfileEncoding = Get-FileEncoding $PROFILE

        $newProfile = @()
        foreach($line in $oldProfile) {
            if ($line -like ('*P'+'osh'+'GitPrompt*')) { continue; }

            if($line -like ('. *'+'p'+'osh-git*pro'+'f'+'ile.ex'+'ample.ps1*')) {
                $line = ('. '+"'$currentVersionPath\profile.example.ps1' "+'cho'+'co')
            }
            if($line -like (('Imp'+'ort-M'+'odu'+'le '+'*F2gsrcF2gposh-'+'g'+'it'+'.'+'psd'+'1*').rEplaCe('F2g',[StrIng][CHAr]92))) {
                $line = ('Import-'+'Mo'+'d'+'ule '+"'$currentVersionPath\src\posh-git.psd1'")
            }
            $newProfile += $line
        }
        Set-Content -path $profile -value $newProfile -Force -Encoding $oldProfileEncoding
    }

    $installer = Join-Path $currentVersionPath ('in'+'s'+'t'+'all.ps1')
    & $installer
} catch {
  try {
    if($oldProfile){ Set-Content -path $PROFILE -value $oldProfile -Force -Encoding $oldProfileEncoding }
  }
  catch {}
  throw
}