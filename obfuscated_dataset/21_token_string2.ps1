. $PSScriptRoot\Shared.ps1

Describe ("{1}{3}{0}{2}"-f'-VcsStatus ','Wr','Tests','ite') {
    Mock -ModuleName posh-git -CommandName git {
        $OFS = " "
        if ($args -contains ("{1}{0}{2}" -f'v-pars','re','e')) {
            $res = Invoke-Expression ("&$gitbin "+"$args")
            return $res
        }
        Convert-NativeLineEnding -SplitLines ((("{2}{12}{3}{4}{9}{13}{6}{14}{8}{5}{1}{11}{7}{0}{10}{15}"-f 't/Baz.Te','r','Et',' ','test/Fo','D test/Ba','ts',' tes','
','o.T','sts.ps1
','.Tests.ps1
M','e

A ','es','.ps1','
Ete'))-RePlacE'Ete',[char]39)
    }

    Context ("{1}{2}{3}{0}" -f 'isabled','AnsiC','ons','ole d') {
        BeforeAll {

            $global:GitPromptSettings = & $module.NewBoundScriptBlock({[PoshGitPromptSettings]::new()})
            $GitPromptSettings.AnsiConsole = $false
        }

        It ("{1}{4}{2}{6}{7}{3}{5}{9}{8}{0}"-f 'tatus','R','r','output f','etu','rom W','ns ','no ','ite-VcsS','r') {

            $OFS = ''
            $res = Write-VcsStatus 6>&1
            "$res" | Should BeExactly ("{0}{1}{3}{2}"-f ' ','[mas','0 -0 ~]','ter +1 ~')


            $res = Write-VcsStatus 6>$null
            $res | Should BeExactly $null
        }
    }

    Context ("{3}{2}{4}{5}{0}{1}{6}"-f'nsole ','e','ns','A','iC','o','nabled') {
        BeforeAll {

            $global:GitPromptSettings = & $module.NewBoundScriptBlock({[PoshGitPromptSettings]::new()})
            $GitPromptSettings.AnsiConsole = $true
        }

        It ("{7}{2}{8}{1}{3}{4}{6}{10}{5}{0}{9}"-f 'ri','t','sta','put ','from W',' st','rite-Vcs','Returns ','tus ou','ng','Status as') {
            $res = Write-VcsStatus
            $res | Should BeExactly " ${csi}93m[${csi}39m${csi}96mmaster${csi}39m${csi}32m +1${csi}39m${csi}32m ~0${csi}39m${csi}32m -0${csi}39m${csi}96m ~${csi}39m${csi}93m]${csi}39m"
        }
    }
}