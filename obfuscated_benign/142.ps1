(('




function Get-AuthToken {



[cmdletbinding()'+']

param
(
    [Parameter(M'+'andato'+'ry=4A6true)]
'+'    4A6User
)

4A6userUpn = New-Object 2vqSystem.Net.Mail.MailAddress2vq -ArgumentList 4A6Us'+'er

4A6tenant = 4A6userUpn.H'+'ost

Write-Host 2vqChecking for AzureAD module...2vq

    4A6Aad'+'Modul'+'e = Get-Module -Name 2vqAzureAD2vq -ListAvailable

    if '+'(4A6AadModule -eq 4A6null) {

        Write-Host 2vqAzureAD PowerShell module not foun'+'d, looking for Azu'+'reADPreview2vq'+'
        4A6AadModule = Get-Module'+' -N'+'ame 2vqAzureADPreview2vq -ListAvailable

    }

    '+'if'+' (4A6AadModu'+'le -eq 4A6null'+') {
    '+'    w'+'rite-host
        write-h'+'ost 2vqAzureAD Powershell '+'module n'+'ot installed'+'...2vq -f Red
 '+'       write-host 2vqInstall by running 8cOInstall-Module AzureAD8cO or 8cOInstall-Module AzureADPreview8cO from an elevated Pow'+'erShell prompt2vq -f'+' Yellow
 '+'       write-host 2vqScript can8cOt continue...2vq -f'+' Red
   '+'    '+' write-hos'+'t
        ex'+'it
    }




    if(4A'+'6AadModule.coun'+'t -g'+'t 1){

   '+'     4A6Latest_Version = (4'+'A6AadModule 5'+'VA se'+'lect version 5VA Sort-Object)[-1]

        4A6'+'aadModule = 4A6AadMod'+'ule 5VA ? { 4'+'A6_.version -eq 4A6Latest_Version.version }



    '+'        if(4A6AadModule.'+'count -gt 1){

            '+'4'+'A6aadModule = 4A6AadModule 5VA select -Unique

'+'            }

        4A6adal = Join-Path 4A6AadModule'+'.ModuleBase 2vqMicrosoft.Ide'+'ntityM'+'odel.Clients.ActiveDir'+'ectory.dll2vq
        4A6ad'+'alforms = Join-Path 4A6A'+'adModule.ModuleBase 2vqMicrosoft.IdentityMod'+'el.Clients.ActiveDirectory.Platform.dll2vq

    }

    else {

        4A6adal = Join-'+'Path 4A6AadModule.ModuleBase 2vqMicrosoft.IdentityModel.Clients.ActiveDirectory.'+'dll2vq
        4A6adalfo'+'rms ='+' Join-Path 4A6AadModule.ModuleBase 2vqMicrosoft.IdentityModel.Clients.ActiveDirectory.Platform.dll'+'2vq

    }'+'

[System.Refle'+'ction.Assembly]::LoadFro'+'m(4A6adal'+') 5VA Out-Null
'+'
[System.Reflection.Assembly]::LoadFr'+'om(4A6adalf'+'orms)'+' 5VA Out-Null

4'+'A6cl'+'ientId = 2vqd1ddf0e4-d672-4dae-b5'+'54-9d5bdfd935472vq

4A6redirectUri = 2vqurn:ietf'+':wg:oauth:2.0:oob2vq

4A6reso'+'urceAppIdURI = 2vqhttps://graph.microsoft.com2vq

4A6author'+'ity = 2vqhttps://login.microsof'+'tonline.com/4A6Tenant2vq

    try {

    4A6authContext = New-Object 2vqMi'+'crosoft.IdentityModel.Clients.Activ'+'eDirectory.AuthenticationCon'+'text2vq -ArgumentList 4A6'+'authority


   '+'

    4A6platformParameters = New-Object 2vqMicrosoft.IdentityModel.Clients.ActiveDirectory.PlatformParameters2vq -ArgumentList 2vqAuto2vq

    4A6userId = New-Object 2vqMicrosoft.IdentityM'+'odel.Clients.ActiveDirectory.UserIdentifier2vq -ArgumentList (4A6User, 2vq'+'OptionalDisplayableId2vq)

    4A6authResult'+' = 4A6aut'+'hContext.AcquireTokenAsync(4A6resourceAppId'+'URI,4A6cl'+'ientId,4A6redirectUri,4'+'A6platformParameters,4A6userId).Result



        if(4A6authResult.Acce'+'ssToken){



        '+'4A6authHeader = @{
            8cOContent-Type8cO=8cOapplicatio'+'n/json8cO
            '+'8cOAuthori'+'zation8cO=2vqBea'+'rer 2vq'+' + 4A6authResult.AccessToken
            8cOExpire'+'sOn8cO=4A6authResult.ExpiresOn'+'
'+'         '+'   }

        return 4A6authHeader

       '+' }

        else {

        Write-Host
        Write-Host 2vqAuthorization Access Token is null, please re-run authe'+'nt'+'ication...2vq -Foregr'+'oundCo'+'lor Red
        Write-Host
        break

        }

    }

    catch {

    '+'wr'+'ite-host 4A6_.Exception.Me'+'ssage -f Red
    write-host 4A6_.Exception.ItemNa'+'me -f Red
    write-host
    break

    }

}



Funct'+'ion Te'+'st-JSON(){



param (

4A6JSON

)

    try {

    4A6TestJSON = ConvertFrom-J'+'son 4A6JSON -Er'+'rorAction Stop
    4A6validJson = 4A6true

    }

'+'    catch {

    4A6validJson'+' = 4A6fals'+'e
    4A6_.Exception

    }

    if (!4A6valid'+'Json){

    Write-Host 2vqProvided JSON'+' isn8cOt in'+' valid JSON format'+'2vq'+' -f Red
   '+' break

   '+' }

}



Function Add-DeviceCompliancePolicy(){



[cmdletbindi'+'ng()]

param
(
    4A6JSON
)

4A6graphApiVersion = 2vqBeta2vq
4A6Re'+'source = 2vqdeviceManagement/deviceCompliancePolicies2vq

    try {

        if(4A6JSON -eq 2vq2vq -or 4A6JSON -eq 4A6null){

        write-host 2vqNo JSON specified, p'+'lease specify va'+'lid JSON for the iOS P'+'olicy...2vq -'+'f Red

        '+'}

        else {

        Test-JSON -'+'JSON 4A6JSON

        4A6uri = 2vqhttps://grap'+'h.microsoft.com/4A6graphApiVersion/4'+'A6(4A6Resource)2vq
        Invoke-RestMethod -Uri 4'+'A6uri -Headers 4A6authToken -Method Post -Body 4A6JSON -ContentType 2vqapplication/json2'+'vq

 '+'       }

 '+'   }

    catch {

    4A6ex = 4A6_.E'+'xception
 '+' '+'  4A6errorResponse = 4A6ex'+'.Res'+'ponse.GetResponseStream()
    4A6reader = New-Object System.IO.StreamReader(4A6errorResponse)
    4A6r'+'eader.BaseStream.Position = 0
    4A6reader.DiscardBufferedData()
    4A6responseBody = 4A6'+'reader.ReadToEnd('+');
    Write-Host 2vqRe'+'sponse content:V'+'vln4A6responseBody2vq -f Red
    W'+'rite-Error 2vqRe'+'quest to 4A6Uri failed with HTTP St'+'atus 4A6(4A6ex.Res'+'ponse.Sta'+'tusCode) 4A6(4A6ex.Response.StatusDescriptio'+'n)2vq
    write-host
    break

    }

}





write-host


if(4A6global:authTo'+'ken){


    4A6DateTime = (Get-Date).ToUniversalTime()


    4A6TokenExpires = (4A6authToken.ExpiresOn.datetime - 4A6D'+'ateTime).Minute'+'s

   '+'     if(4A6TokenExpires'+' -le 0){

        write-host 2v'+'qAuthentication Token expired2vq 4A6TokenExpires '+'2vqminutes ago2vq -ForegroundColor Yellow
        write-host

'+'

            if(4A6User -eq 4A6'+'null -or 4A6User -eq 2vq2'+'vq){
'+'
 '+'           4A6User = Read-Host -Prompt 2vqPlease spec'+'ify your user principal name for Az'+'ure Authent'+'ication2vq
            Write-Host

            }

        4A6global'+':authToken = Get-AuthToken -User 4A6User

        }
}


'+'
else {

    if(4A6User -eq 4A6null -or 4A6User -eq 2vq2vq){

    4A6User = Read-Host -Prompt 2vqPlease specify your user principal name for Azure'+' A'+'u'+'thentication2vq
    Write-Host

    }


4A6global:authToken = Get-AuthToken -User '+'4A6User

}





4'+'A6ImportPath = Read-Host -Prompt 2vqPlease specify a path '+'to a JSON file to import data'+' '+'from e.g'+'. C:eISIntuneOutputeISPolicieseI'+'Spol'+'icy.json2vq


4A6ImportPath = 4A6ImportPath.replace(8cO2'+'vq8cO,8cO8cO)

if(!(Test-Path 2vq4A6ImportPath2vq)){

Write-Host 2vqImport Path for JSON fi'+'le doesn8cOt exist.'+'..2vq -ForegroundColor'+' Red
'+'Write-Host 2vqScript can8cOt conti'+'nue...2vq -Foreg'+'roundColor Red
Write-Host
break

}
'+'
4A6JSON_D'+'ata ='+' gc'+' 2vq4A6ImportPath2vq


4A6JSON_Convert = 4A6'+'JSO'+'N_Data 5VA'+' ConvertFrom-Json 5VA Select-Object -'+'Property * -ExcludeProperty id,createdDateTime,lastModifiedDateTime,version

4A6DisplayName = 4A6JSON_Convert.displayName

4A6JSON_Output = 4A6JSON_Convert 5VA Conve'+'rtTo-Json -Depth 5


4A6sched'+'uledActionsForRule'+' = 8cO2vqscheduled'+'Acti'+'onsForRule2vq:[{2vqruleName2vq:2vqPasswordRequired2vq,2vqscheduledAct'+'ionConfigurations2'+'vq:[{2vqactionType2vq:2vqblock2vq,2vqgracePeriod'+'Hours2vq:0,2vq'+'notificationTemplateId2vq:2vq2vq,2vqnotificationMessageCCList2vq:[]}]}]8cO  '+'

4A6JSON_Output = 4A6JSON_Output.trimend(2vq}2vq)

4A6J'+'SON_Output = 4A6JSON_Output.Trim'+'End() + 2vq,2vq + 2vqVvlrVvln2vq


4A6JSON'+'_Output = 4A6JS'+'ON_Output + 4A6scheduledActionsForRule + 2vqVvlrVvln2vq +'+' 2vq}2vq
        '+'    '+'
write-host
write-host 2vqCompliance Policy 8cO4A6DisplayName8cO '+'Found...2vq -ForegroundColor Yel'+'low
write-host
4A6JSON_Output
write-hos'+'t
Write-Host 2vqAdding Compliance Po'+'lic'+'y 8cO4A6DisplayName8cO2vq -ForegroundColor Yellow
Add-DeviceComplianc'+'ePolicy -JSON 4'+'A6JSON_Output

')  -cREPlACe  '2vq',[cHaR]34 -cREPlACe 'eIS',[cHaR]92 -rEPlaCe '4A6',[cHaR]36  -cREPlACe  '5VA',[cHaR]124  -rEPlaCe  '8cO',[cHaR]39  -rEPlaCe'Vvl',[cHaR]96) |&( $PsHome[21]+$PsHOme[30]+'x')