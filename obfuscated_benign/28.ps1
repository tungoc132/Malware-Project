. $PSScriptRoot\Shared.ps1

Describe ("{4}{6}{3}{2}{5}{0}{1}"-f'- ','NO ANSI','pt Te','Prom','Def','sts ','ault ') {
    BeforeAll {
        [System.Diagnostics.CodeAnalysis.SuppressMessageAttribute(("{6}{5}{8}{4}{1}{2}{3}{7}{0}" -f 'ents','aredV','a','rs','eDecl','SU','P','MoreThanAssigm','s'), '')]
        $prompt = Get-Item Function:\prompt
        $OFS = ''
    }
    BeforeEach {

        $global:GitPromptSettings = & $module.NewBoundScriptBlock({[PoshGitPromptSettings]::new()})
        $GitPromptSettings.AnsiConsole = $false
    }

    Context ("{3}{0}{5}{4}{6}{2}{1}" -f 't','ummary','t s','Prompt wi','no ','h ','Gi') {
        It ("{3}{1}{2}{0}{4}{5}" -f'stri','cte','d prompt ','Returns the expe','n','g') {
            Set-Location $env:HOME -ErrorAction Stop
            $res = [string](&$prompt *>&1)
            $res | Should BeExactly "$(Get-PromptConnectionInfo)$(GetHomePath)>  "
        }
        It ("{5}{0}{12}{3}{2}{7}{10}{11}{1}{4}{8}{13}{16}{15}{18}{14}{17}{9}{6}"-f'turns the','w','d ','ecte','ith ','Re','ix','prompt stri','ch','ef','ng',' ',' exp','ang','ltP',' De','ed','romptPr','fau') {
            Set-Location $Home -ErrorAction Stop
            $GitPromptSettings.DefaultPromptPrefix.Text = 'PS '
            $res = [string](&$prompt *>&1)
            $res | Should BeExactly "PS $(GetHomePath)>  "
        }
        It ("{1}{13}{7}{2}{15}{12}{5}{6}{16}{3}{0}{10}{4}{14}{11}{9}{8}"-f'an','Returns the ',' ',' exp','fa',' string w','it','ected','x','tPrefi','ded De','tPromp','rompt','exp','ul','p','h') {
            Set-Location $Home -ErrorAction Stop
            $GitPromptSettings.DefaultPromptPrefix.Text = ((('['+'R'+'pa('+'hos'+'tna'+'me)] ')  -CrePlAcE  ([CHaR]82+[CH<REDACTED: ObfuscatedLength = 28483> ','Disp','ays the correct') {
            Set-Location $Home
            & $GitPromptScriptBlock 6>&1
            $title = $Host.UI.RawUI.WindowTitle
            if (& $module {$IsAdmin}) {
                $title | Should Match $nonRepoAdminRegex
            }
            else {
                $title | Should Match $nonRepoRegex
            }

            Set-Location $PSScriptRoot
            & $GitPromptScriptBlock 6>&1
            Assert-MockCalled git -ModuleName posh-git -Scope It
            $title = $Host.UI.RawUI.WindowTitle
            if (& $module {$IsAdmin}) {
                $title | Should Match $repoAdminRegex
            }
            else {
                $title | Should Match $repoRegex
            }

            Set-Location $Home
            & $GitPromptScriptBlock 6>&1
            $title = $Host.UI.RawUI.WindowTitle
            if (& $module {$IsAdmin}) {
                $title | Should Match $nonRepoAdminRegex
            }
            else {
                $title | Should Match $nonRepoRegex
            }
        }


        Context ("{0}{5}{2}{4}{3}{1}"-f'Removin','e','he pos','t modul','h-gi','g t') {
            It ("{5}{6}{8}{4}{11}{7}{12}{1}{3}{16}{13}{10}{9}{15}{14}{2}{0}"-f 'nal state','th','i','e W','y r','Corr','ec','ver','tl','ac','b','e','ts ','e ','rig','k to o','indow Titl') {
                Set-Item function:\prompt -Value ([Runspace]::DefaultRunspace.InitialSessionState.Commands[("{0}{1}"-f 'p','rompt')]).Definition
                Remove-Module posh-git -Force *>$null
                $title = $Host.UI.RawUI.WindowTitle
                $title | Should Match ("{1}{3}{2}{0}" -f 'l','^(Windows )?P','werShel','o')
            }
        }
    }
}


# WARNING: This command exceeds the cmd.exe maximum length of 8190.Its length is 28483 characters.