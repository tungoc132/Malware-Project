try {
    $poshgitPath = join-path (Get-ToolsLocation) ('posh'+'g'+'it')

    $currentVersionPath = Get-ChildItem "$poshgitPath\*posh-git*\" | Sort-Object -Property LastWriteTime | Select-Object -Last 1

    if(Test-Path $PROFILE) {
        $oldProfile = @(Get-Content $PROFILE)

        . $currentVersionPath\src\Utils.ps1
        $oldProfileEncoding = Get-FileEncoding $PROFILE

        $newProfile = @()
        foreach($line in $oldProfile) {
            if ($line -like ('*Po'+'sh'+'Gi'+'tPromp'+'t*')) { continue; }
            if ($line -like ('*Load pos'+'h-gi'+'t exampl'+'e'+' pr'+'of'+'ile'+'*')) { continue; }

            if($line -like ('.'+' *'+'p'+'osh-'+'git*'+'pro'+'file.examp'+'le.'+'p'+'s1*')) {
                continue;
            }
            if($line -like (('Impor'+'t-M'+'odule '+'*'+'YPVsr'+'c'+'YP'+'Vpos'+'h-git.ps'+'d1*') -CrEPlacE([CHar]89+[CHar]80+[CHar]86),[CHar]92)) {
                continue;
            }
            $newProfile += $line
        }
        Set-Content -path $profile -value $newProfile -Force -Encoding $oldProfileEncoding
    }

    try {
      if (test-path($poshgitPath)) {
        Write-Host ('Atte'+'mptin'+'g '+'t'+'o '+'re'+'m'+'ove '+'exi'+'st'+'ing '+"`'$poshgitPath`'.")
        remove-item $poshgitPath -recurse -force
      }
    } catch {
      Write-Host ('Co'+'uld'+' '+'n'+'ot '+'remo'+'v'+'e '+"`'$poshgitPath`'")
    }
} catch {
  try {
    if($oldProfile){ Set-Content -path $PROFILE -value $oldProfile -Force -Encoding $oldProfileEncoding }
  }
  catch {}
  throw
}